
{% extends 'base.html'%}

{% block title%}
Login
{% endblock %}

{% block body%}

<h1>Friend requests</h1>
{% extends 'base.html'%} {% block body%}
<div class="messages-container" >
  <h1 class="main-title">Search Friends</h1>
  <form class="searchform group" id="search-form">
    <label for="search-box">
      <span class="fa fa-2x fa-search"></span>
    </label>

    <input type="search" id="search-box" placeholder="Search" />
  </form>

  <!--  -->

  <div id="list">

    <div class="message-tab">
      <div class="user-info">
        <div class="user-group--search">
          <img src="{{ url_for('static', filename='images/user.png')}}" alt="" class="user-photo" />
          <div class="message-wrap">
            <h3 class="user-name">James Doe</h3>
          </div>
        </div>
        <div class="message-info">
          <button>Add friend</button>
        </div>
      </div>
    </div>

    <div class="message-tab">
      <div class="user-info user-info--notactive">
        <div class="user-group--search">
          <img src="{{ url_for('static', filename='images/user.png')}}" alt="" class="user-photo" />
          <div class="message-wrap">
            <h3 class="user-name">James Doe</h3>
          </div>
        </div>
        <div class="message-info">
          <p class="friends-notactive">Your friend</p>
        </div>
      </div>
    </div>

  <!-- </div> -->
  
</div>
<div>
    <ul>
        {% for req in requests %}
        <li> {{req['sender']['username']}} <button onclick="acceptRequest({{req['id']}})">Accept</button> <button onclick="declineRequest({{req['id']}})">Decline</button> </li>
        {% endfor %}
    </ul>
</div>

{% endblock %}

{% block script %}
<script>
    const token = "{{session['token']}}";
    const acceptRequest = function(rid){
        console.log(rid);
        fetch("{{ get_url('api.approve_request') }}" + "?" + new URLSearchParams({
            request_id: rid
        }), {
            method: "POST"
        })
        .then( response => {
            if (response.ok) {
                window.location.replace( "{{ get_url('views.friend_requests') }}" );   
            }
        })
        .catch( error => console.log(error));
    }
    const declineRequest = function(rid){
        fetch("{{ get_url('api.decline_request') }}" + "?" + new URLSearchParams({
            request_id: rid
        }), {
            method: "POST"
        })
        .then( response => {
            if (response.ok) {
                window.location.replace( "{{ get_url('views.friend_requests') }}" );   
            }
        })
        .catch( error => console.log(error));
    }

    console.log("abc")


</script>
{% endblock %}