{% extends 'base.html'%} {% block body%}
<div class="messages-container" >
  <h1 class="main-title">Search Friends</h1>
  <div class="wrapper-search">
    <div class="label-search">Submit your search</div>
    <div class="searchBar">
      <input id="searchQueryInput" type="text" name="searchQueryInput" placeholder="Search" value="" />
      <button id="searchQuerySubmit" type="submit" name="searchQuerySubmit">
        <svg style="width:24px;height:24px" viewBox="0 0 24 24"><path fill="#666666" d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" />
        </svg>
      </button>
    </div>
  </div>

  <!--  -->

  <div id="list">

    <div class="message-tab">
      <div class="user-info">
        <div class="user-group--search">
          <img src="{{ url_for('static', filename='images/user.png')}}" alt="" class="user-photo" />
          <div class="message-wrap">
            <h3 class="user-name">James Doe</h3>
          </div>
        </div>
        <div class="message-info">
          <button>Add friend</button>
        </div>
      </div>
    </div>

    <div class="message-tab">
      <div class="user-info user-info--notactive">
        <div class="user-group--search">
          <img src="{{ url_for('static', filename='images/user.png')}}" alt="" class="user-photo" />
          <div class="message-wrap">
            <h3 class="user-name">James Doe</h3>
          </div>
        </div>
        <div class="message-info">
          <p class="friends-notactive">Your friend</p>
        </div>
      </div>
    </div>

  <!-- </div> -->
  
</div>
{% endblock %}

{% block script %}
<script>
    const form = document.getElementById('search-form');
    const search_input = document.getElementById('search-box');
    const list = document.getElementById("list");

    const sendRequest = function(username){
        
        fetch(`{{ get_url('api.send_request', username='_/temp/_') }}`.replace('_/temp/_', username), {
            method: "POST"
        })
        .then(response => {
            if (response.ok){
                document.getElementById(`li_${username}`).remove();
            }
            return response.json();
        })
        .then(response => console.log(response))
        .catch(error => console.log(error))
    }

    
    const displayResult = ({username, id, email}) => {
        const mainDiv = document.createElement('div');
        mainDiv.setAttribute("id", `li_${username}`)
        mainDiv.classList.add("message-tab")
        mainDiv.innerHTML = `
  <div class="user-info">
    <div class="user-group--search">
      <img src="{{ url_for('static', filename='images/user.png')}}" alt="" class="user-photo" />
      <div class="message-wrap">
        <h3 class="user-name">${username}</h3>
      </div>
    </div>

  </div>
        ` ;

        const buttonDiv = document.createElement("div");
        buttonDiv.innerHTML = `
<div class="message-info">
  <button id='btn-add-${id}'>Add friend</button>
</div>
        `
        mainDiv.firstElementChild.append(buttonDiv)
        buttonDiv.firstElementChild.onclick = () => sendRequest(username);

        list.append(mainDiv);
    }

    form.onsubmit = () => {

        let search_text = search_input.value;
        search_input.value = "";

        if (search_text === "") return false;
        list.innerHTML = "";

        console.log(search_text)

        fetch("{{ get_url('api.search') }}?" + new URLSearchParams({
            search: search_text,
            exclude_friends: 1,
        }))
        .then(response => {
            console.log(response);
            return response.json()})
        .then(data => {
            console.log(data);
            data.data.forEach(displayResult);
            let li = document.createElement("li");
            li.innerHTML = `pages: ${data.pages} page: ${data.page}`;
            list.append(li);
        })
        .catch(error => console.log(error))

        return false;
    }

</script>

{% endblock %}